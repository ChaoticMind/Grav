<!DOCTYPE html>
<html>
<head>
    <title>Test</title>
    <script type='text/javascript'>
        Array.prototype.rotatex = function(angle) {
            return [this[0], this[1]*Math.cos(angle) - this[2]*Math.sin(angle), this[1]*Math.sin(angle) + this[2]*Math.cos(angle)];
        }
        Array.prototype.rotatey = function(angle) {
            return [this[0]*Math.cos(angle) - this[2]*Math.sin(angle), this[1], this[0]*Math.sin(angle) + this[2]*Math.cos(angle)];
        }
        Array.prototype.rotatez = function(angle) {
            return [this[0]*Math.cos(angle) - this[1]*Math.sin(angle), this[0]*Math.sin(angle) + this[1]*Math.cos(angle), this[2]];
        }
        Array.prototype.add = function(vect2) {
            return [this[0]+vect2[0], this[1]+vect2[1], this[2]+vect2[2]];
        }
        Array.prototype.scale = function(factor) {
            factor = 1/factor;
            return [this[0]*factor, this[1]*factor, this[2]*factor];
        }
        window.onload = function() {
            primary = document.getElementById('primary').getContext('2d');
            primary.fillStyle = '#000';
            primary.fillRect(0, 0, 1300/* * 1000 */, 1200/* * 1000 */);
            origin = [400, 400, 0];
            zadd = 0;
            xadd = 0;
            yadd = 0;
            xdeg = 0;
            ydeg = 0;
            zdeg = 0;
            bodies = [];
            for (var i = 50; i--;) {
                bodies[i] = {0:[randInt(1200), -600 + randInt(1200), randInt(300)], c:'rgb(' + (125 + randInt(125)) + ',' + (125 + randInt(125)) + ',' + (125 + randInt(125)) + ')', np:[], scale:0, i:i};
            }
            bodies[bodies.length] = {0:[0,0,0], c:'rgb(255,255,255)', np:[], scale:0, i:100};
            bodies[bodies.length] = {0:[0,0,100], c:'rgb(255,255,0)', np:[], scale:0, i:100};
            pause = false;
            drawBodies(primary);
            document.onkeypress = pageEvents;
            setTimeout(function() {drawBodies(primary);}, 16);
        };
        function pageEvents(ev) {
            var ekey = ev.which;
            if (ekey == 97) {
                xdeg += 1/36;
            }
            if (ekey == 113) {
                xdeg -= 1/36;
            }
            if (ekey == 100) {
                zdeg += 1/36;
            }
            if (ekey == 101) {
                zdeg -= 1/36;
            }
            if (ekey == 115) {
                ydeg += 1/36;
            }
            if (ekey == 119) {
                ydeg -= 1/36;
            }
            if (ekey == 102) {
                zadd += 10;
            }
            if (ekey == 114) {
                zadd -= 10;
            }
            if (ekey == 112) {
                pause = !pause;
                if (!pause) {
                    drawBodies(primary);
                }
            }
            drawBodies(primary, true);
        }
        function drawBodies(primary, dotime) {
            primary.fillStyle = '#000';
            primary.fillRect(0,0,1300,1200);
            var position2, position1;
            // 3D accomplished with assistance from AlteredQualia, 3D effect inspired by CanvasMol
            for (var i = bodies.length; i--;) {
                var position = bodies[i][0].rotatex(xdeg).rotatey(ydeg).rotatez(zdeg);
                var scale = (1200+position[1]+zadd)/1200;
                bodies[i].np = position;
                bodies[i].scale = scale;
            }
            bodies.sort(function(a,b) {return a.np[1]-b.np[1]});
            for (var i = bodies.length; i--;) {
                var position = bodies[i].np;
                var scale = bodies[i].scale;
                if (scale > 0) {
                    position = position.scale(scale);
                    var radius = 10/scale;
                    var grad = primary.createRadialGradient(position[0]+600, position[2]+300, 0.15*radius/scale, position[0]+600, position[2]+300, radius);
                    grad.addColorStop(0, bodies[i].c);
                    grad.addColorStop(0.95, 'rgba(0,0,0,1.0)');
                    grad.addColorStop(1, 'rgba(0,0,0,0.0)');
                    drawBody(position[0]+600, position[2]+300, radius, grad, primary);
                }
            }
            if (!dotime && !pause) {
                zdeg += 1/36;
                setTimeout(function() {drawBodies(primary);}, 64);
            }
        }
        function randInt(limit) {
            return Math.floor(Math.random() * limit);
        }
        function drawBody(x, y, r, color, paper) {
            paper.beginPath();
            paper.arc(x, y, r, 0, Math.PI * 2, 1);
            paper.closePath();
            paper.fillStyle = color;
            paper.fill();
        }
    </script>
</head>
<body>
<canvas id='primary' width='1300' height='1200'></canvas>
</body>
</html>
